<h1 style="font-size: 5em;">Accès NextCloud INRAE</h1>

<a href="https://nextcloud.inrae.fr/s/Ymsmq7p3gimDs7B" target="_blank" style="font-size: 4em;">Accéder au contenu "traitement d'images"</a>
<br><br>

<a href="https://nextcloud.inrae.fr/s/d6toGfTyxoDyGd4" target="_blank" style="font-size: 4em;">Déposer une image</a>
<br><br>

<a href="https://nextcloud.inrae.fr/s/kGrzT26nZ9Y6FBE" target="_blank" style="font-size: 4em;">Consulter Status</a>

<br><br><br>
<h1 style="font-size: 5em;">Accès NextCloud INRAE</h1>

<a href="#" onclick="ouvrirEtRafraichir()" style="font-size: 4em;">Consulter Status</a>

<script>
    let fenetre;
    let intervalleRafraichissement;

    function ouvrirEtRafraichir() {
        // Ouvre la fenêtre si elle est fermée
        if (!fenetre || fenetre.closed) {
            fenetre = window.open("https://nextcloud.inrae.fr/s/kGrzT26nZ9Y6FBE", "fenetreStatus");
            
            // Si un intervalle de rafraîchissement est déjà en cours, le nettoyer
            if (intervalleRafraichissement) {
                clearInterval(intervalleRafraichissement);
            }

            // Définir un intervalle pour rafraîchir la fenêtre toutes les 2 secondes
            intervalleRafraichissement = setInterval(() => {
                if (fenetre && !fenetre.closed) {
                    fenetre.location.reload();
                } else {
                    // Si la fenêtre est fermée, arrête le rafraîchissement
                    clearInterval(intervalleRafraichissement);
                }
            }, 2000);
        }
        
        // Ajouter un observateur pour détecter l'apparition du message d'expiration
        if (fenetre) {
            fenetre.onload = function() {
                let intervalCheck = setInterval(() => {
                    // Vérifier si le message d'expiration de session est présent
                    if (fenetre.document.body.innerText.includes("La session de modification a expiré")) {
                        // Recharger la page automatiquement
                        fenetre.location.reload();
                        clearInterval(intervalCheck); // Arrêter la vérification après rechargement
                    }
                }, 1000); // Vérifier chaque seconde
            }
        }
    }
</script>
