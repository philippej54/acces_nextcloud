<h1 style="font-size: 5em;">Accès NextCloud INRAE</h1>

<a href="https://nextcloud.inrae.fr/s/Ymsmq7p3gimDs7B" target="_blank" style="font-size: 4em;">Accéder au contenu "traitement d'images"</a>
<br><br>

<a href="https://nextcloud.inrae.fr/s/d6toGfTyxoDyGd4" target="_blank" style="font-size: 4em;">Déposer une image</a>
<br><br>

<a href="https://nextcloud.inrae.fr/s/kGrzT26nZ9Y6FBE" target="_blank" style="font-size: 4em;">Consulter Status</a>

<br><br><br>


<a href="#" onclick="ouvrirEtRafraichir()" style="font-size: 4em;">Consulter Status</a>

<script>
    let fenetre;
    let intervalleRafraichissement;

    function ouvrirEtRafraichir() {
        // Ouvre la fenêtre si elle est fermée
        if (!fenetre || fenetre.closed) {
            fenetre = window.open("https://nextcloud.inrae.fr/s/kGrzT26nZ9Y6FBE", "fenetreStatus");

            // Si un intervalle de rafraîchissement est déjà en cours, le nettoyer
            if (intervalleRafraichissement) {
                clearInterval(intervalleRafraichissement);
            }

            // Définir un intervalle pour rafraîchir la fenêtre toutes les 2 secondes
            intervalleRafraichissement = setInterval(() => {
                if (fenetre && !fenetre.closed) {
                    fenetre.location.reload();
                } else {
                    // Si la fenêtre est fermée, arrête le rafraîchissement
                    clearInterval(intervalleRafraichissement);
                }
            }, 2000);
        }
        
        // Ajouter un observateur pour détecter l'apparition du message d'expiration
        if (fenetre) {
            // Utiliser MutationObserver pour surveiller les changements dans le DOM
            const observer = new fenetre.MutationObserver(mutations => {
                mutations.forEach(mutation => {
                    if (mutation.type === 'childList') {
                        // Vérifie si le message d'expiration est présent
                        if (fenetre.document.body.innerText.includes("La session de modification a expiré")) {
                            // Recharger la page automatiquement
                            fenetre.location.reload();
                            observer.disconnect(); // Arrêter l'observateur après rechargement
                        }
                    }
                });
            });

            // Observer la page pour détecter l'ajout de nouveaux éléments
            observer.observe(fenetre.document.body, { childList: true, subtree: true });
        }
    }
</script>
